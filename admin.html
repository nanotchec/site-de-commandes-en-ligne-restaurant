<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thaï Garden – Dashboard admin</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />

  <!-- Tailwind + couleurs -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: '#704B24', accent: '#ED8B00' },
          fontFamily: {
            sans: ['Noto Sans', 'sans-serif'],
            serif: ['Playfair Display', 'serif']
          }
        }
      }
    };
  </script>
  <style>
    body { font-family: 'Noto Sans', sans-serif; }
    h1,h2 { font-family: 'Playfair Display', serif; }
    /* Style for the toggle switch */
    .dot {
      transform: translateX(0);
      transition: transform 0.3s ease-in-out;
    }
    input:checked + .block {
      background-color: #4CAF50; /* Green for open */
    }
    input:checked + .block + .dot {
      transform: translateX(20px);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-gray-50 to-white text-gray-800">

  <!-- Header -->
  <header class="fixed top-0 w-full bg-white/70 backdrop-blur-sm shadow z-50">
    <!-- Top bar -->
    <div class="max-w-5xl mx-auto flex items-center justify-between py-4 px-6">
      <span class="text-2xl font-bold text-primary">Dashboard Thaï Garden</span>
      <div class="flex items-center space-x-2">
        <span class="text-gray-700 font-medium">Restaurant:</span>
        <label for="toggle-restaurant-status" class="flex items-center cursor-pointer">
          <div class="relative">
            <input type="checkbox" id="toggle-restaurant-status" class="sr-only">
            <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
          </div>
          <div id="restaurant-status-text" class="ml-3 text-gray-700 font-semibold">Fermé</div>
        </label>
      </div>
      <a href="index.html" class="text-accent font-semibold hover:underline">← Retour au site</a>
    </div>
    <!-- Secondary navigation -->
    <nav class="border-t border-gray-200">
        <div class="max-w-5xl mx-auto flex gap-4 px-6">
             <button id="tab-demandes" class="flex items-center gap-2 py-3 px-4 border-b-2 border-accent font-semibold">
                Demandes <span id="badge-demandes" class="ml-1 bg-red-500 text-white rounded-full px-2 text-sm hidden">0</span>
            </button>
            <button id="tab-commandes" class="flex items-center gap-2 py-3 px-4 text-gray-600 hover:text-primary">
                Commandes <span id="badge-commandes" class="ml-1 bg-red-500 text-white rounded-full px-2 text-sm hidden">0</span>
            </button>
             <button id="tab-historique" class="flex items-center gap-2 py-3 px-4 text-gray-600 hover:text-primary">
                Historique
            </button>
        </div>
    </nav>
  </header>

  <main class="pt-32 pb-12 max-w-5xl mx-auto px-4">

    <div id="view-demandes">
        <!-- Demandes en attente -->
        <h1 class="text-4xl font-extrabold text-primary text-center mb-10">Demandes en attente</h1>
        <div id="pending-container" class="space-y-4"></div>
    </div>

    <div id="view-commandes" class="hidden">
        <h1 class="text-4xl font-extrabold text-primary text-center mb-10">Commandes</h1>
        <table class="w-full text-left border-collapse">
            <thead>
              <tr class="border-b">
                <th class="p-4">Client</th>
                <th class="p-4">Adresse</th>
                <th class="p-4">Créneau</th>
                <th class="p-4">Contenu</th>
                <th class="p-4">Total</th>
                <th class="p-4">Statut</th>
                <th class="p-4">Action</th>
              </tr>
            </thead>
            <tbody id="commandes-body">
              <!-- Les lignes de commande seront injectées ici par le JS -->
            </tbody>
        </table>
    </div>

    <div id="view-historique" class="hidden">
        <h1 class="text-4xl font-extrabold text-primary text-center mb-10">Historique des demandes</h1>
        <div id="history-container" class="space-y-4"></div>
    </div>

  </main>





  <template id="request-template">
    <div class="bg-white p-4 rounded-lg shadow-md flex flex-col">
      <div>
        <p class="text-lg font-semibold req-name"></p>
        <p class="text-gray-600 req-mode"></p>
        <p class="text-gray-600 req-phone"></p>
        <p class="text-gray-600 req-adresse"></p>
      </div>
      <div class="request-details mt-4"></div>
      <div class="flex gap-2 mt-4 self-end">
        <button class="px-4 py-2 bg-red-500 text-white rounded btn-refuse">Refuser</button>
        <button class="px-4 py-2 bg-green-500 text-white rounded btn-accept">Accepter</button>
      </div>
    </div>
  </template>

  

  <!-- Order Detail Drawer -->
  <div id="order-drawer" class="fixed inset-y-0 right-0 w-96 bg-white shadow-lg transform translate-x-full transition-transform z-[60]" role="dialog" aria-modal="true">
    <header class="flex justify-between items-center p-4 border-b">
      <h3 id="drawer-title" class="text-xl font-semibold"></h3>
      <button id="drawer-close" class="text-gray-600 hover:text-gray-800" aria-label="Fermer le panneau de détails">✖️</button>
    </header>
    <div id="drawer-content" class="p-4 overflow-y-auto h-[calc(100%-64px)]"></div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 right-4 p-4 bg-gray-800 text-white rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-[70]" role="alert"></div>

  <!-- Delivery Slot Modal -->
  <div id="delivery-slot-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[80]">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
      <h3 class="text-2xl font-semibold text-primary mb-6">Saisir le créneau de livraison</h3>
      <input type="time" id="delivery-slot-input" class="border rounded px-3 py-2 text-lg w-full mb-6">
      <div class="flex justify-center gap-4">
        <button id="btn-confirm-slot" class="px-6 py-3 bg-accent text-white font-bold rounded-lg shadow-md hover:shadow-lg transition">Confirmer</button>
        <button id="btn-later-slot" class="px-6 py-3 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">Plus tard</button>
      </div>
    </div>
  </div>

  <!-- Refusal Reason Modal -->
  <div id="refusal-reason-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[80]">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
      <h3 class="text-2xl font-semibold text-primary mb-6 text-center">Motif de refus</h3>
      <div id="refusal-reasons-list" class="space-y-3 mb-6">
        <!-- Reasons will be injected here -->
      </div>
      <textarea id="other-reason-input" class="hidden w-full border rounded px-3 py-2 mb-6" rows="3" placeholder="Précisez le motif..."></textarea>
      <div class="flex justify-center gap-4">
        <button id="btn-confirm-refusal" class="px-6 py-3 bg-red-500 text-white font-bold rounded-lg shadow-md hover:shadow-lg transition">Confirmer le refus</button>
        <button id="btn-cancel-refusal" class="px-6 py-3 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition">Annuler</button>
      </div>
    </div>
  </div>

</body>

  <script>
    /* === Simu base locale : tableau localStorage 'demandes' === */
    function loadDemandes() {
      return JSON.parse(localStorage.getItem('demandes') || '[]');
    }
    function saveDemandes(data) {
      localStorage.setItem('demandes', JSON.stringify(data));
    }

    function loadCommandes() {
        return JSON.parse(localStorage.getItem('commandes') || '[]');
    }

    function saveCommandes(data) {
        localStorage.setItem('commandes', JSON.stringify(data));
    }

    const refusalReasons = [
      "Restaurant complet pour ce créneau.",
      "Zone de livraison non desservie.",
      "Problème technique, veuillez réessayer plus tard.",
      "Informations incomplètes ou incorrectes.",
      "Autre (préciser)"
    ];

    const commandesBody = document.getElementById('commandes-body');

    const pendingEl   = document.getElementById('pending-container');
    const historyEl   = document.getElementById('history-container');
    const tpl         = document.getElementById('request-template');
    let currentId     = null; // id de la demande en cours

    const tabDemandes = document.getElementById('tab-demandes');
    const tabCommandes = document.getElementById('tab-commandes');
    const tabHistorique = document.getElementById('tab-historique');
    const viewDemandes = document.getElementById('view-demandes');
    const viewCommandes = document.getElementById('view-commandes');
    const viewHistorique = document.getElementById('view-historique');

    const badgeDemandes = document.getElementById('badge-demandes');
    const badgeCommandes = document.getElementById('badge-commandes');

    const drawer = document.getElementById('order-drawer');
    const drawerTitle = document.getElementById('drawer-title');
    const drawerContent = document.getElementById('drawer-content');
    const drawerClose = document.getElementById('drawer-close');
    const toast = document.getElementById('toast');
    const deliverySlotModal = document.getElementById('delivery-slot-modal');
    const deliverySlotInput = document.getElementById('delivery-slot-input');
    const btnConfirmSlot = document.getElementById('btn-confirm-slot');
    const btnLaterSlot = document.getElementById('btn-later-slot');
    const refusalReasonModal = document.getElementById('refusal-reason-modal');
    const refusalReasonsList = document.getElementById('refusal-reasons-list');
    const otherReasonInput = document.getElementById('other-reason-input');
    const btnConfirmRefusal = document.getElementById('btn-confirm-refusal');
    const btnCancelRefusal = document.getElementById('btn-cancel-refusal');

    // Restaurant status toggle
    const toggleRestaurantStatus = document.getElementById('toggle-restaurant-status');
    const restaurantStatusText = document.getElementById('restaurant-status-text');

    function getRestaurantStatus() {
      const status = localStorage.getItem('restaurantOuvert');
      return status === null ? true : JSON.parse(status); // Default to true if not set
    }

    function setRestaurantStatus(isOpen) {
      localStorage.setItem('restaurantOuvert', JSON.stringify(isOpen));
      updateRestaurantStatusDisplay(isOpen);
    }

    function updateRestaurantStatusDisplay(isOpen) {
      toggleRestaurantStatus.checked = isOpen;
      restaurantStatusText.textContent = isOpen ? 'Ouvert' : 'Fermé';
      restaurantStatusText.classList.toggle('text-green-600', isOpen);
      restaurantStatusText.classList.toggle('text-red-600', !isOpen);
    }

    // Initialize status on load
    updateRestaurantStatusDisplay(getRestaurantStatus());

    toggleRestaurantStatus.addEventListener('change', (event) => {
      setRestaurantStatus(event.target.checked);
      showToast(`Restaurant ${event.target.checked ? 'ouvert' : 'fermé'}.`);
    });

    drawerClose.onclick = () => closeDrawer();

    let currentDemandeToAccept = null; // Store the demand object temporarily
    let currentDemandeToRefuse = null; // Store the demand object temporarily

    btnConfirmSlot.addEventListener('click', () => {
      const slot = deliverySlotInput.value;
      if (currentDemandeToAccept) {
        createCommandFromDemand(currentDemandeToAccept, slot);
        deliverySlotModal.classList.add('hidden');
        currentDemandeToAccept = null;
      }
    });

    btnLaterSlot.addEventListener('click', () => {
      if (currentDemandeToAccept) {
        createCommandFromDemand(currentDemandeToAccept, ''); // Empty slot
        deliverySlotModal.classList.add('hidden');
        currentDemandeToAccept = null;
      }
    });

    btnConfirmRefusal.addEventListener('click', () => {
      let selectedReason = '';
      const selectedRadio = refusalReasonsList.querySelector('input[name="refusal-reason"]:checked');
      if (selectedRadio) {
        selectedReason = selectedRadio.value;
        if (selectedReason === 'Autre (préciser)') {
          selectedReason = otherReasonInput.value.trim();
        }
      }

      if (currentDemandeToRefuse && selectedReason) {
        updateStatut(currentDemandeToRefuse.id, 'refused', selectedReason);
        refusalReasonModal.classList.add('hidden');
        currentDemandeToRefuse = null;
        otherReasonInput.classList.add('hidden');
        otherReasonInput.value = '';
      } else {
        showToast('Veuillez sélectionner un motif de refus ou préciser "Autre".');
      }
    });

    btnCancelRefusal.addEventListener('click', () => {
      refusalReasonModal.classList.add('hidden');
      currentDemandeToRefuse = null;
      otherReasonInput.classList.add('hidden');
      otherReasonInput.value = '';
    });

    function promptForRefusalReason(demandeId) {
      const demandes = loadDemandes();
      currentDemandeToRefuse = demandes.find(d => d.id === demandeId);
      if (!currentDemandeToRefuse) return;

      refusalReasonsList.innerHTML = '';
      refusalReasons.forEach((reason, index) => {
        const div = document.createElement('div');
        div.className = 'flex items-center';
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'refusal-reason';
        input.id = `reason-${index}`;
        input.value = reason;
        input.className = 'mr-2';
        input.addEventListener('change', () => {
          if (reason === 'Autre (préciser)') {
            otherReasonInput.classList.remove('hidden');
            otherReasonInput.focus();
          } else {
            otherReasonInput.classList.add('hidden');
            otherReasonInput.value = '';
          }
        });

        const label = document.createElement('label');
        label.htmlFor = `reason-${index}`;
        label.textContent = reason;

        div.appendChild(input);
        div.appendChild(label);
        refusalReasonsList.appendChild(div);
      });

      refusalReasonModal.classList.remove('hidden');
    }

    function createCommandFromDemand(demande, deliverySlot) {
      const commandes = loadCommandes();
      const newCommand = {
        id: `cmd-${Date.now()}`,
        demandeId: demande.id,
        customer: { name: demande.nom, address: demande.adresse, phone: demande.tel },
        deliverySlot: deliverySlot,
        items: demande.items,
        total: demande.total,
        status: 'submitted'
      };
      commandes.push(newCommand);
      saveCommandes(commandes);
      showToast('Demande acceptée et commande créée.');
      render();
    }

    function openDetailsDrawer(orderId) {
        const commandes = loadCommandes();
        const order = commandes.find(c => c.id === orderId);
        if (!order) return;

        if (!drawer.classList.contains('translate-x-full') && drawerTitle.textContent.includes(order.id.slice(4))) {
            closeDrawer();
            return;
        }

        drawerTitle.textContent = `Commande #${order.id.slice(4)}`;
        
        const itemsHtml = order.items.map(item => {
            if (item.isWok && item.details) {
                return `
                    <li class="mb-2">
                        <strong>${item.name} (${item.quantity})</strong>
                        <ul class="list-disc list-inside pl-4 text-sm">
                            <li><strong>Base:</strong> ${item.details.base}</li>
                            <li><strong>Pulpes:</strong> ${item.details.pulpes.join(', ') || 'Aucune'}</li>
                            <li><strong>Favoris:</strong> ${item.details.favoris.join(', ') || 'Aucun'}</li>
                            <li><strong>Sauce:</strong> ${item.details.sauce}</li>
                            <li><strong>Toppings:</strong> ${item.details.toppings.join(', ') || 'Aucun'}</li>
                        </ul>
                    </li>`;
            } else {
                return `<li>- ${item.name} (${item.quantity})</li>`;
            }
        }).join('');

        let contentHtml = `
            <p><strong>Client:</strong> ${order.customer.name}</p>
            <p><strong>Adresse:</strong> ${order.customer.address}</p>
            <p><strong>Téléphone:</strong> ${order.customer.phone}</p>
            <p><strong>Créneau:</strong> ${order.deliverySlot || 'Non défini'}</p>
            <p><strong>Total:</strong> ${order.total.toFixed(2)}€</p>
            <h4 class="font-semibold mt-4">Articles:</h4>
            <ul>${itemsHtml}</ul>
        `;
        drawerContent.innerHTML = contentHtml;
        drawer.classList.remove('translate-x-full');
    }

    function closeDrawer() {
      drawer.classList.add('translate-x-full');
      showToast('Détails de la commande fermés.');
    }

    // Close drawer when clicking outside
    document.addEventListener('click', (event) => {
      const isClickInsideDrawer = drawer.contains(event.target);
      const isDetailButton = event.target.classList.contains('text-accent'); // Assuming 'text-accent' is unique to detail buttons
      if (!isClickInsideDrawer && !isDetailButton && !drawer.classList.contains('translate-x-full')) {
        closeDrawer();
      }
    });

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.remove('hidden');
      // Force reflow to ensure transition plays
      toast.offsetWidth;
      toast.classList.add('opacity-100');

      setTimeout(() => {
        toast.classList.remove('opacity-100');
        // Wait for fade-out transition to complete before hiding
        toast.addEventListener('transitionend', () => {
          toast.classList.add('hidden');
        }, { once: true });
      }, 4000); // Display for 4 seconds
    }

    function setActiveTab(activeTab) {
        const tabs = [tabDemandes, tabCommandes, tabHistorique];
        const views = [viewDemandes, viewCommandes, viewHistorique];

        tabs.forEach((tab, index) => {
            const view = views[index];
            if (tab === activeTab) {
                view.classList.remove('hidden');
                tab.classList.add('border-b-2', 'border-accent', 'font-semibold');
                tab.classList.remove('text-gray-600', 'hover:text-primary');
            } else {
                view.classList.add('hidden');
                tab.classList.remove('border-b-2', 'border-accent', 'font-semibold');
                tab.classList.add('text-gray-600', 'hover:text-primary');
            }
        });
    }

    tabDemandes.addEventListener('click', () => setActiveTab(tabDemandes));
    tabCommandes.addEventListener('click', () => setActiveTab(tabCommandes));
    tabHistorique.addEventListener('click', () => setActiveTab(tabHistorique));

    /* Rendu initial */
    render();
    setActiveTab(tabDemandes);

    /* Re-render si localStorage change */
    window.addEventListener('storage', () => {
      render();
    });

    function render() {
      const demandes = loadDemandes();
      renderDemandes(demandes);

      const commandes = loadCommandes();
      renderCommandes(commandes);

      updateBadges(demandes, commandes);
    }

    function updateBadges(demandes, commandes) {
        const badgeDemandes = document.getElementById('badge-demandes');
        const badgeCommandes = document.getElementById('badge-commandes');

        const pendingDemandes = demandes.filter(d => d.statut === 'pending').length;
        badgeDemandes.textContent = pendingDemandes;
        badgeDemandes.classList.toggle('hidden', pendingDemandes === 0);

        const activeCommandes = commandes.filter(c => c.status !== 'delivered').length;
        badgeCommandes.textContent = activeCommandes;
        badgeCommandes.classList.toggle('hidden', activeCommandes === 0);
    }

    function updateOrderStatus(orderId, newStatus) {
        const commandes = loadCommandes();
        const order = commandes.find(o => o.id === orderId);
        if (order) {
            order.status = newStatus;
            saveCommandes(commandes);
            render();
            showToast(`Commande marquée comme ${statusConfig[newStatus].text}.`);
        }
    }

    function updateDeliverySlot(orderId, newSlot) {
        const commandes = loadCommandes();
        const order = commandes.find(o => o.id === orderId);
        if (order) {
            order.deliverySlot = newSlot;
            saveCommandes(commandes);
            render();
            showToast(`Créneau de livraison mis à jour pour la commande #${order.id.slice(4)}.`);
        }
    }

    function renderDemandes(data) {
      pendingEl.innerHTML = '';
      historyEl.innerHTML = '';

      data.forEach(req => {
        const node = tpl.content.cloneNode(true);
        node.querySelector('.req-name').textContent  = req.nom;
        node.querySelector('.req-mode').textContent  = req.mode;
        node.querySelector('.req-phone').textContent = req.tel;
        node.querySelector('.req-adresse').textContent = req.adresse;

        // Display items and total for the demand
        const itemsHtml = req.items.map(item => {
            if (item.isWok && item.details) {
                return `
                    <li class="mb-1 text-sm">
                        <strong>${item.name} (${item.quantity})</strong>
                        <ul class="list-disc list-inside pl-4 text-xs">
                            <li>Base: ${item.details.base}</li>
                            <li>Pulpes: ${item.details.pulpes.join(', ') || 'Aucune'}</li>
                            <li>Favoris: ${item.details.favoris.join(', ') || 'Aucun'}</li>
                            <li>Sauce: ${item.details.sauce}</li>
                            <li>Toppings: ${item.details.toppings.join(', ') || 'Aucun'}</li>
                        </ul>
                    </li>`;
            } else {
                return `<li class="text-sm">- ${item.name} (${item.quantity})</li>`;
            }
        }).join('');

        const detailsDiv = document.createElement('div');
        detailsDiv.innerHTML = `
            <h4 class="font-semibold mt-2">Articles:</h4>
            <ul class="list-none">${itemsHtml}</ul>
            <p class="font-bold mt-2">Total: ${req.total.toFixed(2)}€</p>
        `;
        node.querySelector('.request-details').appendChild(detailsDiv);

        if (req.statut === 'pending') {
          node.querySelector('.btn-refuse').onclick  = () => { promptForRefusalReason(req.id); };
          node.querySelector('.btn-accept').onclick  = () => { updateStatut(req.id, 'accepted'); };
          pendingEl.appendChild(node);
        } else {
          // Transformation pour l’historique
          node.querySelector('.btn-refuse').remove();
          const btn = node.querySelector('.btn-accept');
          btn.className =
            'px-4 py-2 rounded text-white ' +
            (req.statut === 'accepted' ? 'bg-green-600' : 'bg-red-600');
          btn.textContent =
            req.statut === 'accepted' ? 'Acceptée' : 'Refusée';
          if (req.statut === 'refused' && req.refusalReason) {
            const reasonP = document.createElement('p');
            reasonP.className = 'text-sm text-red-500 mt-2';
            reasonP.textContent = `Motif: ${req.refusalReason}`;
            node.querySelector('.request-details').appendChild(reasonP);
          }
          historyEl.appendChild(node);
        }
      });
    }

    function renderCommandes(commandes) {
        commandesBody.innerHTML = '';
        const statusConfig = {
            submitted: { icon: '⏳', color: 'bg-accent/10', text: 'En attente' },
            preparing: { icon: '<span class="text-accent-dark">🍳</span>', color: 'bg-yellow-100', text: 'En préparation' },
            ready: { icon: '<span class="text-green-600">✅</span>', color: 'bg-green-100', text: 'Prête' },
            delivered: { icon: '<span class="text-gray-500">🚚</span>', color: 'bg-gray-100', text: 'Livrée' }
        };

        commandes.forEach(order => {
            const config = statusConfig[order.status] || {};
            const tr = document.createElement('tr');
            tr.className = `border-b ${config.color || ''}`;
            tr.innerHTML = `
                <td class="p-4">${order.customer.name}</td>
                <td class="p-4">${order.customer.address}</td>
                <td class="p-4">
                    <input type="time" class="border rounded px-2 py-1" value="${order.deliverySlot || ''}" onchange="updateDeliverySlot('${order.id}', this.value)">
                </td>
                <td class="p-4">${order.items.length} article(s)</td>
                <td class="p-4">${order.total.toFixed(2)}€</td>
                <td class="p-4">
                    ${config.icon || ''} 
                    <select class="border rounded px-2 py-1" onchange="updateOrderStatus('${order.id}', this.value)">
                        <option value="submitted" ${order.status === 'submitted' ? 'selected' : ''}>${statusConfig.submitted.text}</option>
                        <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>${statusConfig.preparing.text}</option>
                        <option value="ready" ${order.status === 'ready' ? 'selected' : ''}>${statusConfig.ready.text}</option>
                        <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>${statusConfig.delivered.text}</option>
                    </select>
                </td>
                <td class="p-4"><button class="text-accent underline" onclick="openDetailsDrawer('${order.id}')">Détail</button></td>
            `;
            commandesBody.appendChild(tr);
        });
    }

    function updateStatut(id, statut, refusalReason = null) {
      const demandes = loadDemandes();
      const demandeIndex = demandes.findIndex(r => r.id === id);
      if (demandeIndex > -1) {
        const demande = demandes[demandeIndex];
        demande.statut = statut;
        if (statut === 'refused') {
          demande.refusalReason = refusalReason;
        }

        if (statut === 'accepted') {
          saveDemandes(demandes); // Save the updated status to localStorage
          currentDemandeToAccept = demande;
          deliverySlotInput.value = ''; // Clear previous value
          deliverySlotModal.classList.remove('hidden');
        } else if (statut === 'refused') {
          showToast('Demande refusée.');
          saveDemandes(demandes); // Save changes for refused demand
          render();
        }
      }
    }
  </script>
</body>
</html>